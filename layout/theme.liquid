<!doctype html>
<html class="no-js" lang="{{ request.locale.iso_code }}" data-form-required-error="{{ 'forms.validation.required' | t }}" data-form-email-error="{{ 'forms.validation.email' | t }}">
<head>
<!-- PRECONNECT and DNS Prefetch - Critical for performance -->
<link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
<link rel="dns-prefetch" href="https://cdn.shopify.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="dns-prefetch" href="https://www.googletagmanager.com">
<link rel="dns-prefetch" href="https://connect.facebook.net">

<!-- Preload critical JavaScript -->
<link rel="modulepreload" href="{{ 'theme-editor.js' | asset_url }}">

<!-- Note: Image preloading should be done in sections, not in layout -->
{%- comment -%}
<!-- Preload de la primera imagen visible (hero) -->
{% if section.settings.image %}
  <link rel="preload" as="image" loading="eager"
    fetchpriority="high" href="{{ section.settings.image | image_url: width: 1920, quality: 85, format: 'webp' }}" imagesrcset="{{ section.settings.image | image_url: width: 750, quality: 85, format: 'webp' }} 750w, {{ section.settings.image | image_url: width: 1920, quality: 85, format: 'webp' }} 1920w" imagesizes="100vw">
{% endif %}

<!-- Preload del logo -->
<link rel="preload" as="image" href="{{ section.settings.logo | image_url: width: 200, quality: 85, format: 'webp' }}">
{%- endcomment -%}
    <!-- Meta Tags Básicos -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="">
    <link rel="canonical" href="{{ canonical_url }}">

    <!-- SEO Meta Description - Uses page-specific description or falls back to default -->
    {% if page_description %}
      <meta name="description" content="{{ page_description | escape }}">
    {% else %}
      <meta name="description" content="TechAura - Tienda líder en Colombia de productos tecnológicos: memorias USB personalizadas, gadgets electrónicos, smartwatches y accesorios tecnológicos con envío a todo el país">
    {% endif %}
    
    <!-- Localización Colombia -->
    <meta name="geo.region" content="CO">
    <meta name="geo.placename" content="Colombia">
    <meta name="geo.position" content="4.570868;-74.297333">
    <meta name="ICBM" content="4.570868, -74.297333">
    <meta name="country" content="Colombia">
    <meta name="language" content="es-CO">
    <meta name="distribution" content="Colombia">
    
    <!-- SEO Esencial TechAura -->
    <meta name="keywords" content="tecnología Colombia, memorias USB personalizadas, gadgets electrónicos, smartwatches, accesorios tecnológicos, tienda tech Colombia, productos electrónicos">
    <meta name="author" content="TechAura">
    <meta name="robots" content="index, follow">
    <meta name="revisit-after" content="7 days">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="TechAura - Tecnología y Gadgets en Colombia">
    <meta property="og:description" content="Encuentra los mejores productos tecnológicos en Colombia: memorias USB personalizadas, smartwatches, gadgets y más con envío nacional">
    <meta property="og:url" content="{{ canonical_url }}">
    <meta property="og:site_name" content="TechAura Colombia">
    <meta property="og:locale" content="es_CO">
    <meta property="og:country-name" content="Colombia">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="TechAura - Tecnología en Colombia">
    <meta name="twitter:description" content="Productos tecnológicos y gadgets con envío a todo Colombia">
    <meta name="twitter:site" content="@techauraz">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "TechAura",
      "alternateName": "Techauraz",
      "url": "{{ shop.url }}",
      {% comment %} "logo": "{{ 'logo.png' | asset_url }}", {% endcomment %}
      "description": "Tienda líder en Colombia de productos tecnológicos: memorias USB personalizadas, gadgets electrónicos, smartwatches y accesorios tech con envío gratis",
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "CO",
        "addressRegion": "Colombia"
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+57-300-860-2789",
        "contactType": "customer service",
        "areaServed": "CO",
        "availableLanguage": ["Spanish"]
      },
      "sameAs": [
        "{{ settings.social_facebook_link }}",
        "{{ settings.social_instagram_link }}",
        "{{ settings.social_twitter_link }}"
      ]
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "TechAura",
      "url": "{{ shop.url }}",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "{{ shop.url }}/search?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
    </script>

    {%- if template.name == 'product' and product -%}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Product",
      "name": {{ product.title | json }},
      "description": {{ product.description | strip_html | truncate: 250 | json }},
      "image": {{ product.featured_image | image_url: width: 1200 | json }},
      "url": "{{ shop.url }}{{ product.url }}",
      "brand": {
        "@type": "Brand",
        "name": "TechAura"
      },
      "offers": {
        "@type": "Offer",
        "url": "{{ shop.url }}{{ product.url }}",
        "priceCurrency": "COP",
        "price": "{{ product.selected_or_first_available_variant.price | divided_by: 100.0 }}",
        "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
        "seller": {
          "@type": "Organization",
          "name": "TechAura"
        },
        "priceValidUntil": "{{ 'now' | date: '%s' | plus: 2592000 | date: '%Y-%m-%d' }}",
        "shippingDetails": {
          "@type": "OfferShippingDetails",
          "shippingRate": {
            "@type": "MonetaryAmount",
            "value": "0",
            "currency": "COP"
          },
          "shippingDestination": {
            "@type": "DefinedRegion",
            "addressCountry": "CO"
          },
          "deliveryTime": {
            "@type": "ShippingDeliveryTime",
            "businessDays": {
              "@type": "OpeningHoursSpecification",
              "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]
            },
            "cutoffTime": "23:59:59",
            "handlingTime": {
              "@type": "QuantitativeValue",
              "minValue": 2,
              "maxValue": 5,
              "unitCode": "DAY"
            }
          }
        }
      }
    }
    </script>
    {%- endif -%}

    <!-- Favicon -->
    {%- if settings.favicon != blank -%}
      <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32, quality: 85, format: 'webp' }}">
    {%- endif -%}

    <!-- Preconnect para fuentes -->
    {%- unless settings.type_header_font.system? and settings.type_body_font.system? -%}
      <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    {%- endunless -%}

    <!-- Título y Meta Description Dinámicos -->
    {%- assign path_parts = request.path | split: '/' -%}
    {%- assign base_path = path_parts | last -%}
    {%- unless request.page_type == 'list-collections' or request.page_type == 'collection' and base_path == 'all' -%}
    <title>
        TechAura - Tecnología y Gadgets en Colombia | Envío Nacional
    </title>
    {%- endunless -%}
    
    <!-- Preload critical resources -->
    <link rel="preload" as="script" href="{{ 'global.js' | asset_url }}">
    
    <!-- DNS prefetch para external domains -->
<link rel="dns-prefetch" href="https://fonts.shopifycdn.com">
<link rel="dns-prefetch" href="https://cdn.shopify.com">

    <!-- Meta Tags de Shopify -->
    {% render 'meta-tags' %}

    {%- comment -%} SEO: Breadcrumbs Structured Data {%- endcomment -%}
    {% render 'schema-breadcrumbs' %}

    <!-- Scripts Principales -->
    <script src="{{ 'constants.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'pubsub.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'global.js' | asset_url }}" defer="defer"></script>
    
    {%- if settings.animations_reveal_on_scroll -%}
      <script src="{{ 'animations.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    
    {%- comment -%} Scripts del rediseño {%- endcomment -%}
    {%- if template.name == 'product' -%}
      <script src="{{ 'cross-sell.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    
    {%- comment -%} Purchase notifications - cargar solo en home y product {%- endcomment -%}
    {%- if template.name == 'index' or template.name == 'product' -%}
      <script src="{{ 'purchase-notification.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    
    {%- comment -%} Image loading enhancement - all pages {%- endcomment -%}
    <script src="{{ 'image-loading.js' | asset_url }}" defer="defer"></script>

    {{ content_for_header }}

    <!-- Estilos de Fuentes -->
    {%- liquid
      assign body_font_bold = settings.type_body_font | font_modify: 'weight', 'bold'
      assign body_font_italic = settings.type_body_font | font_modify: 'style', 'italic'
      assign body_font_bold_italic = body_font_bold | font_modify: 'style', 'italic'
    %}

<!-- CSS completo con preload + async -->
<link rel="preload" href="{{ 'base.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'base.css' | asset_url }}"></noscript>

{%- comment -%} Load animations CSS only if enabled {%- endcomment -%}
{%- if settings.animations_reveal_on_scroll -%}
  <link rel="preload" href="{{ 'animations.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="{{ 'animations.css' | asset_url }}"></noscript>
{%- endif -%}

{%- comment -%} Load cross-sell CSS only on product pages {%- endcomment -%}
{%- if template.name == 'product' -%}
  <link rel="preload" href="{{ 'cross-sell.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="{{ 'cross-sell.css' | asset_url }}"></noscript>
{%- endif -%}

<!-- TechAura Unified CSS - Consolidated, optimized theme styles -->
<link rel="preload" href="{{ 'techauraz-unified.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'techauraz-unified.css' | asset_url }}"></noscript>

<!-- TechAura Conversion 2024 CSS - Conversion-focused enhancements -->
<link rel="preload" href="{{ 'techauraz-conversion-2024.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'techauraz-conversion-2024.css' | asset_url }}"></noscript>

<!-- TechAura Forms CSS - Enhanced form styling -->
<link rel="preload" href="{{ 'forms-techauraz.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'forms-techauraz.css' | asset_url }}"></noscript>

<!-- TechAura Responsive Audit Fixes - Comprehensive responsive & accessibility improvements -->
<link rel="preload" href="{{ 'responsive-audit-fixes.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'responsive-audit-fixes.css' | asset_url }}"></noscript>

<!-- Card Clickable Fix - Full card area clickable for better mobile UX -->
<link rel="preload" href="{{ 'card-clickable-fix.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'card-clickable-fix.css' | asset_url }}"></noscript>

<!-- Product Page Visual Fixes 2024 - Banner, buttons, description, footer improvements -->
<link rel="preload" href="{{ 'product-page-consolidated.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'product-page-consolidated.css' | asset_url }}"></noscript>

<!-- Visual System Unified 2024 - Rating visibility, dark theme palette, badge system -->
<link rel="preload" href="{{ 'visual-system-unified-2024.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'visual-system-unified-2024.css' | asset_url }}"></noscript>

<!-- Responsive Mobile Unified 2024 - Consolidated mobile fixes (replaces 3 files) -->
<!-- Replaces: storefront-visual-fixes-2024.css, mobile-view-fixes-2024.css, mobile-visual-fixes-jan-2024.css -->
<link rel="preload" href="{{ 'responsive-mobile-unified.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'responsive-mobile-unified.css' | asset_url }}"></noscript>

<!-- Storefront Polish Refinements 2024 - Final polish for sales-ready experience -->
<link rel="preload" href="{{ 'storefront-polish-refinements-2024.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'storefront-polish-refinements-2024.css' | asset_url }}"></noscript>

<!-- PDP Scroll Trigger Fixes - Ensures buttons and critical elements are always visible -->
<link rel="preload" href="{{ 'pdp-scroll-trigger-fixes.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'pdp-scroll-trigger-fixes.css' | asset_url }}"></noscript>

<!-- 
  ============================================================================
  CSS LOADING ORDER
  ============================================================================
  
  The following stylesheets are loaded in this order in the layout:
  
  1. base.css (preload with fallback)
     - Core Dawn theme styles (with 62.5% base font-size = 10px per 1rem)
     - Body text base overridden to 1.6rem (16px) for better readability
     
  2. animations.css (conditional - only if animations enabled in settings)
     - Animation utilities and scroll reveal animations
     
  3. cross-sell.css (conditional - product pages only)
     - Cross-sell component styles for product pages
     
  4. techauraz-unified.css (preload with fallback) ✨
     - Consolidated and optimized TechAura theme styles including:
       • Normalized typography (fixes zoom effect)
       • Compact, aligned header for desktop and mobile
       • Professional tech store color palette (blue/cyan)
       • Proper slideshow/hero controls positioning
       • Normalized card sizing and spacing
       • Persuasive visual elements
       • Resolved CSS conflicts from previous files
       • Mobile drawer functionality (focus trap, scroll lock)
       • Performance optimizations
     
     This replaces the previous three files:
     - techauraz-master.css (deprecated)
     - techauraz-ui-enhancements.css (deprecated)
     - techauraz-polish-2024.css (deprecated)
  
  5. forms-techauraz.css (preload with fallback)
     - Enhanced form styling and validation states
  
  6. responsive-audit-fixes.css ✨
     - Comprehensive responsive design fixes:
       • Z-index hierarchy (header, modals, drawers, WhatsApp, cookie banner)
       • Typography and legibility improvements
       • Smooth animations with cubic-bezier timing
       • prefers-reduced-motion support
       • Touch targets (minimum 44x44px on mobile)
       • Safe area insets for iPhone X+
       • Overflow prevention and layout fixes
       • Utility classes for common patterns
  
  7. card-clickable-fix.css
     - Full card area clickable for better mobile UX
  
  8. product-page-consolidated.css
     - Banner, buttons, description, footer improvements
  
  9. visual-system-unified-2024.css
     - Rating visibility, dark theme palette, badge system
  
  10. responsive-mobile-unified.css ✨ NEW (2024-01-15)
      - CONSOLIDATED mobile fixes (replaces 3 previous files):
        • Replaces: storefront-visual-fixes-2024.css
        • Replaces: mobile-view-fixes-2024.css
        • Replaces: mobile-visual-fixes-jan-2024.css
      - Complete mobile fixes including:
        • Hero/slider - single slide display (no double images)
        • Product grid - strict 2-column layout with proper spacing
        • WhatsApp FAB - proper positioning with cookie bar awareness
        • Text clipping prevention for headings and descriptions
        • Button contrast improvements (COMPRAR AHORA, AGREGAR AL CARRITO)
        • Product card badge visibility (Envío rápido, En stock)
        • Section spacing and alignment
        • Touch target optimization (44px minimum)
        • iOS safe area support
        • Reduced motion accessibility support
  
  11. storefront-polish-refinements-2024.css
      - Final polish for sales-ready experience
  
  12. Component-specific CSS files loaded per section as needed
      - component-*.css files loaded dynamically by sections
  
  ============================================================================
-->

    <!-- Preload de Fuentes -->
    {%- unless settings.type_body_font.system? -%}
      <link rel="preload" as="font" href="{{ settings.type_body_font | font_url }}" type="font/woff2" crossorigin>
    {%- endunless -%}
    {%- unless settings.type_header_font.system? -%}
      <link rel="preload" as="font" href="{{ settings.type_header_font | font_url }}" type="font/woff2" crossorigin>
    {%- endunless -%}

    <!-- Componentes Adicionales -->
    {%- if localization.available_countries.size > 1 or localization.available_languages.size > 1 -%}
      {{ 'component-localization-form.css' | asset_url | stylesheet_tag: preload: true }}
      <script src="{{ 'localization-form.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {%- if settings.predictive_search_enabled -%}
      <link
        rel="stylesheet"
        href="{{ 'component-predictive-search.css' | asset_url }}"
        media="print"
        onload="this.media='all'"
      >
    {%- endif -%}

    <!-- Script de Inicialización -->
    <script defer="defer">
      document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
      if (Shopify.designMode) {
        document.documentElement.classList.add('shopify-design-mode');
      }
    </script>

    <!-- Google Webmaster Tools Site Verification -->
    <meta name="google-site-verification" content="fj7UYrB5GV0ojQhLbYR8XqrgfSDiY8Bcqz-npt1MvQo" />
    {% comment %} Soporte WebP automático {% endcomment %}
   <script defer="defer">
     document.addEventListener('DOMContentLoaded', function() {
       if(window.HTMLCanvasElement) {
         var img = new Image();
         img.onload = img.onerror = function() {
           document.documentElement.className += (img.height == 1) ? ' webp' : ' no-webp';
         };
         img.src = 'data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==';
       }
     });
   </script>
   <!-- GOOGLE TAG MANAGER - OPTIMIZED -->
<script>
(function(w,d,s,l,i){
  // Performance optimization constants
  var GTM_DELAY = 5000;           // Delay before auto-loading GTM (5s)
  var GTM_IDLE_TIMEOUT = 7000;    // Timeout for idle callback (7s)
  var GTM_INTERACTION_DELAY = 100; // Short delay after interaction to avoid blocking (100ms - GTM is lighter)
  
  // Load GTM only after user interaction or idle time
  function loadGTM() {
    if (w.gtmLoaded) return;
    w.gtmLoaded = true;
    
    w[l]=w[l]||[];
    w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
    j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
    f.parentNode.insertBefore(j,f);
  }
  
  // Load after delay or on first scroll/click/touch
  var timer = setTimeout(loadGTM, GTM_DELAY);
  
  ['scroll', 'mousemove', 'touchstart', 'click'].forEach(function(e) {
    window.addEventListener(e, function() {
      clearTimeout(timer);
      // Delay slightly to not block interaction
      setTimeout(loadGTM, GTM_INTERACTION_DELAY);
    }, { once: true, passive: true });
  });
  
  // Load on idle if supported
  if ('requestIdleCallback' in window) {
    requestIdleCallback(function() {
      clearTimeout(timer);
      loadGTM();
    }, { timeout: GTM_IDLE_TIMEOUT });
  }
})(window,document,'script','dataLayer','GTM-PB6TD2ZD');
</script>
<!-- FACEBOOK PIXEL - OPTIMIZED -->
<script>
(function() {
  // Performance optimization constants
  var FB_DELAY = 6000;            // Delay before auto-loading FB Pixel (6s)
  var FB_IDLE_TIMEOUT = 8000;     // Timeout for idle callback (8s)
  var FB_INTERACTION_DELAY = 200; // Longer delay after interaction (200ms - FB Pixel is heavier than GTM)
  
  var fbLoaded = false;
  
  function loadFBPixel() {
    if (fbLoaded) return;
    fbLoaded = true;
    
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}
    (window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
    
    fbq('init', '809161240853412');
    fbq('track', 'PageView');
  }
  
  // Load only after interaction or idle - later than GTM
  var timer = setTimeout(loadFBPixel, FB_DELAY);
  ['scroll', 'mousemove', 'touchstart', 'click'].forEach(function(e) {
    window.addEventListener(e, function() {
      clearTimeout(timer);
      // Delay to reduce impact on interaction
      setTimeout(loadFBPixel, FB_INTERACTION_DELAY);
    }, { once: true, passive: true });
  });
  
  // Load on idle if supported
  if ('requestIdleCallback' in window) {
    requestIdleCallback(function() {
      clearTimeout(timer);
      loadFBPixel();
    }, { timeout: FB_IDLE_TIMEOUT });
  }
})();
</script>
</head>

<body class="gradient{% if settings.animations_hover_elements != 'none' %} animate--hover-{{ settings.animations_hover_elements }}{% endif %}">

    <a class="skip-to-content-link button visually-hidden" href="#MainContent">
      {{ 'accessibility.skip_to_text' | t }}
    </a>

    {%- if settings.cart_type == 'drawer' -%}
      {%- render 'cart-drawer' -%}
    {%- endif -%}

    {% sections 'header-group' %}

    <main id="MainContent" class="content-for-layout focus-none" role="main" tabindex="-1">
      {{ content_for_layout }}
    </main>

    {% sections 'footer-group' %}

    {%- comment -%} Cookie Banner - GDPR Compliance {%- endcomment -%}
    {% render 'cookie-banner' %}

    <ul hidden>
      <li id="a11y-refresh-page-message">{{ 'accessibility.refresh_page' | t }}</li>
      <li id="a11y-new-window-message">{{ 'accessibility.link_messages.new_window' | t }}</li>
    </ul>

    <script defer="defer">
      window.shopUrl = '{{ request.origin }}';
      window.routes = {
        cart_add_url: '{{ routes.cart_add_url }}',
        cart_change_url: '{{ routes.cart_change_url }}',
        cart_update_url: '{{ routes.cart_update_url }}',
        cart_url: '{{ routes.cart_url }}',
        predictive_search_url: '{{ routes.predictive_search_url }}',
      };

      window.cartStrings = {
        error: `{{ 'sections.cart.cart_error' | t }}`,
        quantityError: `{{ 'sections.cart.cart_quantity_error_html' | t: quantity: '[quantity]' }}`,
      };

      window.variantStrings = {
        addToCart: `{{ 'products.product.add_to_cart' | t }}`,
        soldOut: `{{ 'products.product.sold_out' | t }}`,
        unavailable: `{{ 'products.product.unavailable' | t }}`,
        unavailable_with_option: `{{ 'products.product.value_unavailable' | t: option_value: '[value]' }}`,
      };

      window.quickOrderListStrings = {
        itemsAdded: `{{ 'sections.quick_order_list.items_added.other' | t: quantity: '[quantity]' }}`,
        itemAdded: `{{ 'sections.quick_order_list.items_added.one' | t: quantity: '[quantity]' }}`,
        itemsRemoved: `{{ 'sections.quick_order_list.items_removed.other' | t: quantity: '[quantity]' }}`,
        itemRemoved: `{{ 'sections.quick_order_list.items_removed.one' | t: quantity: '[quantity]' }}`,
        viewCart: `{{- 'sections.quick_order_list.view_cart' | t -}}`,
        each: `{{- 'sections.quick_order_list.each' | t: money: '[money]' }}`,
      };

      window.accessibilityStrings = {
        imageAvailable: `{{ 'products.product.media.image_available' | t: index: '[index]' }}`,
        shareSuccess: `{{ 'general.share.success_message' | t }}`,
        pauseSlideshow: `{{ 'sections.slideshow.pause_slideshow' | t }}`,
        playSlideshow: `{{ 'sections.slideshow.play_slideshow' | t }}`,
        recipientFormExpanded: `{{ 'recipient.form.expanded' | t }}`,
        recipientFormCollapsed: `{{ 'recipient.form.collapsed' | t }}`,
        countrySelectorSearchCount: `{{ 'localization.country_results_count' | t: count: '[count]' }}`,
      };

      // Remove button classes if element exists
      const agregarCar = document.querySelector('.product-form__submit[id*="ProductSubmitButton"]');
      if (agregarCar) {
        agregarCar.classList.remove("button--full-width", "button--secondary");
      }
    </script>

    {%- if settings.predictive_search_enabled -%}
      <script src="{{ 'predictive-search.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    <script src="{{ 'custom-scripts.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'techauraz-enhancements.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'mobile-fixes-handler.js' | asset_url }}" defer="defer"></script>
    <script defer="defer">
  (function(){
var header = document.querySelector('.section-header, .header-wrapper');
if(!header) return;
function isMobileLike(){ return window.matchMedia('(max-width: 989.98px)').matches; }

var lastY = window.scrollY || 0;
var ticking = false;

function onScroll(){
  if(!isMobileLike()){ 
    header.classList.remove('header--hide'); 
    header.classList.remove('header--show');
    lastY = window.scrollY || 0;
    ticking = false;
    return;
  }

  var y = window.scrollY || 0;
  var delta = y - lastY;

  var menuOpen = document.querySelector('.menu-drawer[open]') || document.querySelector('.header__submenu[open]') || document.querySelector('.predictive-search[open]');
  if(menuOpen){
    header.classList.remove('header--hide');
    header.classList.add('header--show');
    lastY = y; ticking = false; return;
  }

  if(delta < -4){
    header.classList.remove('header--hide');
    header.classList.add('header--show');
  }else if(delta > 4 && y > 100){
    header.classList.remove('header--show');
    header.classList.add('header--hide');
  }
  lastY = y;
  ticking = false;
}

function onResize(){
  if(!isMobileLike()){
    header.style.transform = '';
    header.classList.remove('header--hide');
    header.classList.remove('header--show');
  }else{
    header.classList.add('header--show');
  }
}

window.addEventListener('scroll', function(){
  if(!ticking){
    window.requestAnimationFrame(onScroll);
    ticking = true;
  }
}, {passive:true});

window.addEventListener('resize', onResize);
onResize();
})();

// Sticky header shrink on scroll
(function() {
  const headerWrapper = document.querySelector('.header-wrapper, .section-header');
  if (!headerWrapper) return;
  
  let lastScrollY = 0;
  let ticking = false;
  
  function updateHeaderOnScroll() {
    const scrollY = window.scrollY || window.pageYOffset;
    
    // Add 'scrolled' class when scrolled down more than 50px
    if (scrollY > 50) {
      headerWrapper.classList.add('scrolled');
    } else {
      headerWrapper.classList.remove('scrolled');
    }
    
    lastScrollY = scrollY;
    ticking = false;
  }
  
  function requestTick() {
    if (!ticking) {
      window.requestAnimationFrame(updateHeaderOnScroll);
      ticking = true;
    }
  }
  
  window.addEventListener('scroll', requestTick, { passive: true });
  updateHeaderOnScroll(); // Initial check
})();
</script>
<!-- BOTÓN WHATSAPP FLOTANTE -->
<style>
  .whatsapp-float {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 997; /* Below slideshow controls (999+) and cookie banner (998) */
    animation: fadeInUp 0.6s ease-out;
  }
  
  /* Desktop: Add bottom offset to avoid overlapping hero CTA and slideshow controls */
  @media screen and (min-width: 750px) {
    .whatsapp-float {
      bottom: 100px; /* Increased offset on desktop to clear hero CTA buttons and slideshow controls */
      right: 30px;
    }
  }

  .whatsapp-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    min-width: 60px;
    min-height: 60px;
    max-width: 60px;
    max-height: 60px;
    background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
    border-radius: 50%;
    box-shadow: 0 6px 20px rgba(37, 211, 102, 0.35);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: none;
    text-decoration: none;
    position: relative;
    flex-shrink: 0;
    overflow: hidden;
  }

  .whatsapp-button svg {
    width: 32px;
    height: 32px;
    fill: white;
    transition: transform 0.3s ease;
    display: block;
    margin: auto;
  }

  .whatsapp-button:hover {
    transform: scale(1.08) rotate(3deg);
    box-shadow: 0 10px 28px rgba(37, 211, 102, 0.45);
  }

  .whatsapp-button:hover svg {
    transform: scale(1.1);
  }

  .whatsapp-button::before {
    content: '';
    position: absolute;
    inset: -5px;
    border-radius: 50%;
    background: rgba(37, 211, 102, 0.3);
    animation: pulse 2s infinite;
    z-index: -1;
  }

  .whatsapp-tooltip {
    position: absolute;
    right: 70px;
    top: 50%;
    transform: translateY(-50%);
    background: white;
    color: #1f2937;
    padding: 12px 18px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    white-space: nowrap;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    pointer-events: none;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  .whatsapp-tooltip::after {
    content: '';
    position: absolute;
    right: -8px;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-left: 8px solid white;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
  }

  .whatsapp-float:hover .whatsapp-tooltip {
    opacity: 1;
    visibility: visible;
    right: 75px;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.15);
    }
  }

  @keyframes shake {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(-5deg); }
    75% { transform: rotate(5deg); }
  }

  .whatsapp-button.shake {
    animation: shake 0.5s ease;
  }

  @media (max-width: 768px) {
    .whatsapp-float {
      bottom: 15px;
      right: 15px;
    }
    .whatsapp-button {
      width: 56px;
      height: 56px;
      min-width: 56px;
      min-height: 56px;
      max-width: 56px;
      max-height: 56px;
    }
    .whatsapp-button svg {
      width: 28px;
      height: 28px;
    }
    .whatsapp-tooltip {
      display: none;
    }
  }
</style>

<div class="whatsapp-float">
  <div class="whatsapp-tooltip">
    ¿Necesitas ayuda? ¡Escríbenos!
  </div>
  
  <a 
    href="https://wa.me/573008602789?text=Hola%2C%20me%20encuentro%20interesado%20en%20los%20productos." 
    class="whatsapp-button"
    target="_blank"
    rel="noopener noreferrer"
    aria-label="Contactar por WhatsApp"
  >
    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <path d="M16 0c-8.837 0-16 7.163-16 16 0 2.825 0.737 5.607 2.137 8.048l-2.137 7.952 7.933-2.127c2.42 1.37 5.173 2.127 8.067 2.127 8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 29.467c-2.482 0-4.908-0.646-7.07-1.87l-0.507-0.292-5.25 1.408 1.408-5.248-0.292-0.508c-1.207-2.100-1.843-4.479-1.843-6.957 0-7.51 6.11-13.617 13.617-13.617s13.617 6.107 13.617 13.617c0 7.508-6.108 13.467-13.68 13.467zM21.617 18.517c-0.375-0.188-2.217-1.092-2.558-1.217s-0.592-0.187-0.842 0.188-0.967 1.217-1.183 1.467-0.433 0.279-0.808 0.092-1.575-0.583-3-1.858c-1.108-0.992-1.858-2.217-2.075-2.592s-0.025-0.575 0.162-0.762c0.167-0.167 0.375-0.433 0.562-0.65s0.25-0.375 0.375-0.625 0.063-0.467-0.031-0.654-0.842-2.025-1.154-2.775c-0.308-0.733-0.617-0.625-0.842-0.625s-0.467-0.031-0.717-0.031-0.654 0.092-0.996 0.467-1.308 1.279-1.308 3.117 1.342 3.617 1.529 3.867 2.625 4.008 6.358 5.625c0.887 0.383 1.579 0.608 2.117 0.779 0.892 0.279 1.704 0.242 2.346 0.146 0.717-0.108 2.217-0.908 2.529-1.783s0.312-1.625 0.217-1.783-0.346-0.25-0.721-0.438z"/>
    </svg>
  </a>
</div>

<script>
  // WhatsApp button animations - load on idle to reduce main thread blocking
  if ('requestIdleCallback' in window) {
    requestIdleCallback(function() {
      initWhatsAppButton();
    }, { timeout: 3000 });
  } else {
    // Fallback for browsers without requestIdleCallback
    setTimeout(initWhatsAppButton, 2000);
  }
  
  function initWhatsAppButton() {
    const whatsappBtn = document.querySelector('.whatsapp-button');
    if (!whatsappBtn) return;
    
    // Initial shake after delay
    setTimeout(() => {
      whatsappBtn.classList.add('shake');
      setTimeout(() => whatsappBtn.classList.remove('shake'), 500);
    }, 1000);

    // Periodic shake
    setInterval(() => {
      whatsappBtn.classList.add('shake');
      setTimeout(() => whatsappBtn.classList.remove('shake'), 500);
    }, 15000);

    // Track clicks (only if gtag is loaded)
    whatsappBtn.addEventListener('click', function() {
      if (typeof gtag !== 'undefined') {
        gtag('event', 'click', {
          'event_category': 'WhatsApp',
          'event_label': 'Floating Button Click'
        });
      }
    });
  }
</script>
<script src="{{ 'tiny-img-link-preloader.js' | asset_url }}" defer></script>
<!-- TRACKING OPTIMIZADO - SOLO UNA VEZ -->
<script defer="defer">
  // Defer de scripts de terceros
  function loadScriptDefer(src, id) {
    if(document.getElementById(id)) return;
    var script = document.createElement('script');
    script.id = id;
    script.src = src;
    script.defer = true;
    document.body.appendChild(script);
  }
  
</script>
<!-- RENDERING OPTIMIZATION -->
<script>
  // Defer non-critical scripts using requestIdleCallback
  if ('requestIdleCallback' in window) {
    requestIdleCallback(function() {
      // Load third-party widgets in idle time
      // Here go widgets like Tidio, Klaviyo, etc. if needed
    }, { timeout: 5000 });
  } else {
    // Fallback: use setTimeout for older browsers
    window.addEventListener('load', function() {
      setTimeout(function() {
        // Here go widgets like Tidio, Klaviyo, etc.
      }, 3000);
    });
  }
  
  // Optimize scroll handlers - consolidate into one with debounce
  let scrollTicking = false;
  let lastScrollY = 0;
  
  function handleScroll() {
    lastScrollY = window.scrollY || window.pageYOffset;
    scrollTicking = false;
    // Any scroll logic here runs with requestAnimationFrame
  }
  
  window.addEventListener('scroll', function() {
    if (!scrollTicking) {
      window.requestAnimationFrame(handleScroll);
      scrollTicking = true;
    }
  }, { passive: true });
</script>
</body> </html>
