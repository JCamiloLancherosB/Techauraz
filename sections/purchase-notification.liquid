{%- if section.settings.enable_notifications -%}
<div 
  class="purchase-notification" 
  data-notification-toast
  data-interval="{{ section.settings.interval }}"
  role="status"
  aria-live="polite"
  aria-atomic="true"
  hidden
>
  <div class="purchase-notification__content">
    <div class="purchase-notification__icon" aria-hidden="true">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M9 11l3 3L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="purchase-notification__text">
      <p class="purchase-notification__message">
        <strong data-customer-name></strong> de <span data-customer-location></span> compró
        <span data-product-name></span>
      </p>
      <p class="purchase-notification__time">Hace <span data-time-ago></span></p>
    </div>
    <button 
      class="purchase-notification__close" 
      type="button"
      aria-label="Cerrar notificación"
      data-notification-close
    >
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
        <path d="M12 4L4 12M4 4l8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </div>
</div>

<script>
  class PurchaseNotification {
    constructor(element) {
      this.element = element;
      this.interval = parseInt(element.dataset.interval) * 1000 || 15000;
      this.closeBtn = element.querySelector('[data-notification-close]');
      this.currentIndex = 0;
      this.isVisible = false;
      
      // Sample notifications data
      this.notifications = [
        {
          customerName: 'María G.',
          location: 'Bogotá',
          product: 'Audífonos Bluetooth Premium',
          timeAgo: '5 minutos'
        },
        {
          customerName: 'Carlos R.',
          location: 'Medellín',
          product: 'Smartwatch Pro',
          timeAgo: '12 minutos'
        },
        {
          customerName: 'Ana T.',
          location: 'Cali',
          product: 'Cargador Rápido USB-C',
          timeAgo: '18 minutos'
        },
        {
          customerName: 'Juan M.',
          location: 'Barranquilla',
          product: 'Memoria USB 64GB',
          timeAgo: '25 minutos'
        },
        {
          customerName: 'Laura P.',
          location: 'Cartagena',
          product: 'Mouse Gaming RGB',
          timeAgo: '32 minutos'
        }
      ];

      this.init();
    }

    init() {
      this.closeBtn.addEventListener('click', () => this.hide());
      
      // Start showing notifications after initial delay
      setTimeout(() => this.show(), 5000);
      
      // Set interval for rotating notifications
      this.notificationInterval = setInterval(() => {
        if (!this.isVisible) {
          this.show();
        }
      }, this.interval);
    }

    show() {
      if (this.isVisible) return;
      
      const notification = this.notifications[this.currentIndex];
      
      // Update notification content
      this.element.querySelector('[data-customer-name]').textContent = notification.customerName;
      this.element.querySelector('[data-customer-location]').textContent = notification.location;
      this.element.querySelector('[data-product-name]').textContent = notification.product;
      this.element.querySelector('[data-time-ago]').textContent = notification.timeAgo;
      
      // Show notification
      this.element.hidden = false;
      this.isVisible = true;
      
      // Auto-hide after 5 seconds
      setTimeout(() => this.hide(), 5000);
      
      // Move to next notification
      this.currentIndex = (this.currentIndex + 1) % this.notifications.length;
    }

    hide() {
      this.element.hidden = true;
      this.isVisible = false;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    const notificationElement = document.querySelector('[data-notification-toast]');
    if (notificationElement && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      new PurchaseNotification(notificationElement);
    }
  });
</script>

{%- endif -%}

{% schema %}
{
  "name": "Notificación de Compras",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_notifications",
      "label": "Activar notificaciones",
      "default": true,
      "info": "Muestra notificaciones de compras recientes (datos de ejemplo)"
    },
    {
      "type": "range",
      "id": "interval",
      "min": 10,
      "max": 60,
      "step": 5,
      "unit": "s",
      "label": "Intervalo entre notificaciones",
      "default": 15,
      "info": "Tiempo en segundos entre cada notificación"
    }
  ],
  "presets": [
    {
      "name": "Notificación de Compras"
    }
  ]
}
{% endschema %}
