{%- comment -%}
  Product Reviews Summary
  Compact star-rating bar displayed between title and price on PDP.
  Shows metafield-based rating or a placeholder when no reviews exist.
  Pure CSS + Liquid — no JavaScript.
{%- endcomment -%}

{%- if section.settings.show_section -%}
{{ 'product-reviews-summary.css' | asset_url | stylesheet_tag }}

{%- assign rating_value = product.metafields.reviews.rating.value -%}
{%- assign rating_count = product.metafields.reviews.rating_count.value -%}

<div class="product-reviews-summary" data-section-id="{{ section.id }}">
  {%- if rating_value -%}
    {%- comment -%} Real rating from metafields {%- endcomment -%}
    <div class="product-reviews-summary__stars" role="img" aria-label="{{ rating_value }} de 5 estrellas">
      {%- assign rating_int = rating_value | floor -%}
      {%- assign rating_decimal = rating_value | modulo: 1 -%}
      {%- assign half_star_pos = rating_int | plus: 1 -%}
      {%- for i in (1..5) -%}
        {%- if i <= rating_int -%}
          <svg class="product-reviews-summary__star product-reviews-summary__star--full" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        {%- elsif i == half_star_pos and rating_decimal > 0 -%}
          <svg class="product-reviews-summary__star product-reviews-summary__star--half" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><defs><linearGradient id="half-{{ section.id }}"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="var(--ta-border, #e2e8f0)"/></linearGradient></defs><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" fill="url(#half-{{ section.id }})"/></svg>
        {%- else -%}
          <svg class="product-reviews-summary__star product-reviews-summary__star--empty" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        {%- endif -%}
      {%- endfor -%}
    </div>
    <span class="product-reviews-summary__text">
      {{ rating_value }} de 5
      {%- if rating_count %} · Basado en {{ rating_count }} opiniones{%- endif -%}
    </span>
  {%- else -%}
    {%- comment -%} Placeholder when no reviews {%- endcomment -%}
    <div class="product-reviews-summary__stars product-reviews-summary__stars--placeholder" role="img" aria-label="{{ section.settings.placeholder_text }}">
      {%- for i in (1..5) -%}
        <svg class="product-reviews-summary__star product-reviews-summary__star--full" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
      {%- endfor -%}
    </div>
    <span class="product-reviews-summary__text">{{ section.settings.placeholder_text }}</span>
  {%- endif -%}
</div>

{%- endif -%}

{% schema %}
{
  "name": "Reviews Summary (PDP)",
  "tag": "section",
  "class": "product-reviews-summary-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_section",
      "label": "Mostrar sección",
      "default": true
    },
    {
      "type": "text",
      "id": "placeholder_text",
      "label": "Texto placeholder (sin reviews)",
      "default": "Calificación garantizada"
    }
  ],
  "templates": ["product"]
}
{% endschema %}
