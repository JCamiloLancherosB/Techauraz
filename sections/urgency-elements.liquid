{% comment %}
  Urgency Elements Section
  Elementos de urgencia y confianza para páginas de producto (CRO optimizado)
{% endcomment %}

<div class="urgency-elements">
  {% if section.settings.show_stock_counter %}
    <div class="urgency-element urgency-stock">
      <div class="urgency-icon">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 2L2 7L10 12L18 7L10 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 12L10 17L18 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="urgency-content">
        <span class="urgency-label">Stock limitado:</span>
        <span class="urgency-value stock-counter" data-stock="12">¡Solo quedan 12 unidades!</span>
      </div>
    </div>
  {% endif %}

  {% if section.settings.show_viewing_counter %}
    <div class="urgency-element urgency-viewers">
      <div class="urgency-icon">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M1 10C1 10 4 4 10 4C16 4 19 10 19 10C19 10 16 16 10 16C4 16 1 10 1 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="urgency-content">
        <span class="urgency-value viewers-counter" data-viewers="8">8 personas están viendo este producto</span>
      </div>
    </div>
  {% endif %}

  {% if section.settings.show_countdown and section.settings.countdown_end_date != blank %}
    <div class="urgency-element urgency-countdown">
      <div class="urgency-icon">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
          <path d="M10 6V10L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="urgency-content">
        <span class="urgency-label">Oferta termina en:</span>
        <div class="countdown-timer" data-end-date="{{ section.settings.countdown_end_date }}">
          <span class="countdown-unit">
            <span class="countdown-value" data-hours>00</span>
            <span class="countdown-label">h</span>
          </span>
          <span class="countdown-separator">:</span>
          <span class="countdown-unit">
            <span class="countdown-value" data-minutes>00</span>
            <span class="countdown-label">m</span>
          </span>
          <span class="countdown-separator">:</span>
          <span class="countdown-unit">
            <span class="countdown-value" data-seconds>00</span>
            <span class="countdown-label">s</span>
          </span>
        </div>
      </div>
    </div>
  {% endif %}

  {% if section.settings.show_delivery_estimate %}
    <div class="urgency-element urgency-delivery">
      <div class="urgency-icon">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M1 1H4L6.68 13.39C6.77 13.83 7.17 14.14 7.62 14.14H16.38C16.83 14.14 17.23 13.83 17.32 13.39L19 6H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="8" cy="18" r="1" fill="currentColor"/>
          <circle cx="16" cy="18" r="1" fill="currentColor"/>
        </svg>
      </div>
      <div class="urgency-content">
        <span class="urgency-value">Ordena en las próximas <strong>2 horas</strong> y recíbelo en <strong>2-3 días</strong></span>
      </div>
    </div>
  {% endif %}
</div>

<script>
// Simular viewers counter dinámico
function updateViewersCounter() {
  const viewersEl = document.querySelector('.viewers-counter');
  if (!viewersEl) return;
  
  const baseViewers = parseInt(viewersEl.dataset.viewers) || 5;
  const variation = Math.floor(Math.random() * 5) - 2; // -2 a +2
  const newViewers = Math.max(1, baseViewers + variation);
  
  viewersEl.textContent = `${newViewers} personas están viendo este producto`;
  viewersEl.dataset.viewers = newViewers;
}

// Actualizar viewers cada 30 segundos
setInterval(updateViewersCounter, 30000);

// Countdown timer
function initCountdown() {
  const countdownEl = document.querySelector('.countdown-timer');
  if (!countdownEl) return;
  
  const endDate = new Date(countdownEl.dataset.endDate);
  if (!endDate || isNaN(endDate)) return;
  
  function updateCountdown() {
    const now = new Date();
    const distance = endDate - now;
    
    if (distance < 0) {
      countdownEl.innerHTML = '<span class="urgency-value">¡Oferta terminada!</span>';
      return;
    }
    
    const hours = Math.floor(distance / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
    
    const hoursEl = countdownEl.querySelector('[data-hours]');
    const minutesEl = countdownEl.querySelector('[data-minutes]');
    const secondsEl = countdownEl.querySelector('[data-seconds]');
    
    if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
    if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
    if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
  }
  
  updateCountdown();
  setInterval(updateCountdown, 1000);
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initCountdown);
} else {
  initCountdown();
}
</script>

{% schema %}
{
  "name": "Elementos de Urgencia",
  "tag": "section",
  "class": "section-urgency",
  "settings": [
    {
      "type": "header",
      "content": "Stock Counter"
    },
    {
      "type": "checkbox",
      "id": "show_stock_counter",
      "label": "Mostrar contador de stock",
      "default": true,
      "info": "Muestra cuántas unidades quedan disponibles"
    },
    {
      "type": "header",
      "content": "Viewing Counter"
    },
    {
      "type": "checkbox",
      "id": "show_viewing_counter",
      "label": "Mostrar contador de visualizaciones",
      "default": true,
      "info": "Muestra cuántas personas están viendo el producto"
    },
    {
      "type": "header",
      "content": "Countdown Timer"
    },
    {
      "type": "checkbox",
      "id": "show_countdown",
      "label": "Mostrar temporizador de oferta",
      "default": false
    },
    {
      "type": "text",
      "id": "countdown_end_date",
      "label": "Fecha de fin de oferta",
      "info": "Formato: YYYY-MM-DD HH:MM:SS (ej: 2024-12-31 23:59:59)"
    },
    {
      "type": "header",
      "content": "Delivery Estimate"
    },
    {
      "type": "checkbox",
      "id": "show_delivery_estimate",
      "label": "Mostrar estimado de entrega",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Elementos de Urgencia"
    }
  ]
}
{% endschema %}
