{%- if section.settings.enable_sticky_cta and product -%}
{%- assign show_secondary_cta = section.settings.enable_secondary_cta -%}
<div 
  class="sticky-cta-bar{% if show_secondary_cta %} sticky-cta-bar--dual{% endif %}" 
  data-sticky-cta
  data-buy-button-text="{{ section.settings.buy_button_text | default: 'Comprar ahora' }}"
  data-add-button-text="{{ section.settings.add_button_text | default: 'Añadir' }}"
  role="region"
  aria-label="Botones de compra rápida"
  aria-hidden="true"
>
  {%- comment -%} 
    Sticky CTA benefits - simplified version of canonical trust strip.
    Shows max 2 benefits to avoid duplication overload.
    These should mirror/subset the canonical trust_line block benefits.
  {%- endcomment -%}
  {%- if section.settings.show_benefits -%}
    <div class="sticky-cta-bar__benefits">
      <span class="sticky-cta-bar__benefit">
        <svg class="sticky-cta-bar__benefit-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M5 18H19V20H5V18ZM12 2L12.39 2.03C15.19 2.24 17.51 3.94 18.5 6.31L21 12L18.5 12V16H5.5V12L3 12L5.5 6.31C6.49 3.94 8.81 2.24 11.61 2.03L12 2Z" fill="currentColor"/>
          <path d="M12 4C9.79 4 7.96 5.56 7.18 7.71L6 10.5H18L16.82 7.71C16.04 5.56 14.21 4 12 4Z" fill="currentColor"/>
        </svg>
        <span>{{ section.settings.benefit_1_text | default: 'Envío Gratis' }}</span>
      </span>
      <span class="sticky-cta-bar__benefit-divider" aria-hidden="true">•</span>
      <span class="sticky-cta-bar__benefit">
        <svg class="sticky-cta-bar__benefit-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z" fill="currentColor"/>
        </svg>
        <span>{{ section.settings.benefit_2_text | default: 'Contraentrega' }}</span>
      </span>
    </div>
  {%- endif -%}
  
  <div class="sticky-cta-bar__container">
    <div class="sticky-cta-bar__info">
      <div class="sticky-cta-bar__price" data-sticky-price>
        {%- if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
          <span class="sticky-cta-bar__price-sale">{{ product.selected_or_first_available_variant.price | money }}</span>
          <span class="sticky-cta-bar__price-compare">{{ product.selected_or_first_available_variant.compare_at_price | money }}</span>
        {%- else -%}
          <span class="sticky-cta-bar__price-regular">{{ product.selected_or_first_available_variant.price | money }}</span>
        {%- endif -%}
      </div>
    </div>
    <div class="sticky-cta-bar__buttons">
      {%- comment -%} Primary CTA: Buy Now (accelerated checkout) {%- endcomment -%}
      <button
        type="button"
        class="sticky-cta-bar__button sticky-cta-bar__button--buy"
        data-sticky-buy
        data-action="buy-now"
        {%- if product.selected_or_first_available_variant.available == false -%}
          disabled
          aria-disabled="true"
        {%- endif -%}
        aria-label="{% if product.selected_or_first_available_variant.available %}Comprar {{ product.title }} ahora{% else %}Producto agotado{% endif %}"
      >
        <svg class="sticky-cta-bar__icon" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="sticky-cta-bar__text">
          {%- if product.selected_or_first_available_variant.available == false -%}
            Agotado
          {%- else -%}
            {{ section.settings.buy_button_text | default: 'Comprar ahora' }}
          {%- endif -%}
        </span>
      </button>
      {%- comment -%} Secondary CTA: Add to Cart {%- endcomment -%}
      {%- if show_secondary_cta -%}
      <button
        type="button"
        class="sticky-cta-bar__button sticky-cta-bar__button--secondary"
        data-sticky-add
        data-action="add-to-cart"
        {%- if product.selected_or_first_available_variant.available == false -%}
          disabled
          aria-disabled="true"
        {%- endif -%}
        aria-label="{% if product.selected_or_first_available_variant.available %}Añadir {{ product.title }} al carrito{% else %}Producto agotado{% endif %}"
      >
        <svg class="sticky-cta-bar__icon" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="9" cy="21" r="1" fill="currentColor"/>
          <circle cx="20" cy="21" r="1" fill="currentColor"/>
        </svg>
        <span class="sticky-cta-bar__text">{{ section.settings.add_button_text | default: 'Añadir' }}</span>
      </button>
      {%- endif -%}
    </div>
  </div>
</div>

{%- comment -%} 
  Styles have been moved to assets/techauraz-custom-ui.css
  for maintainability and predictable cascade.
{%- endcomment -%}

{%- comment -%}
  JavaScript moved to assets/sticky-cta.js for better caching and maintainability.
  Uses data-sticky-cta attribute for initialization and data-buy-button-text / data-add-button-text for configuration.
{%- endcomment -%}
<script src="{{ 'sticky-cta.js' | asset_url }}" defer="defer"></script>

{%- endif -%}

{% schema %}
{
  "name": "Barra CTA Sticky Mobile",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sticky_cta",
      "label": "Activar barra sticky",
      "default": true,
      "info": "Muestra botones fijos de compra en móvil cuando el CTA principal está fuera de vista"
    },
    {
      "type": "checkbox",
      "id": "enable_secondary_cta",
      "label": "Mostrar botón secundario",
      "default": false,
      "info": "Muestra un botón 'Añadir al carrito' junto al botón principal 'Comprar ahora'"
    },
    {
      "type": "checkbox",
      "id": "show_benefits",
      "label": "Mostrar beneficios inline",
      "default": true,
      "info": "Muestra beneficios cortos (Envío / Contraentrega) arriba del botón"
    },
    {
      "type": "text",
      "id": "benefit_1_text",
      "label": "Beneficio 1",
      "default": "Envío Gratis"
    },
    {
      "type": "text",
      "id": "benefit_2_text",
      "label": "Beneficio 2",
      "default": "Contraentrega"
    },
    {
      "type": "text",
      "id": "buy_button_text",
      "label": "Texto botón comprar",
      "default": "Comprar ahora"
    },
    {
      "type": "text",
      "id": "add_button_text",
      "label": "Texto botón añadir al carrito",
      "default": "Añadir"
    },
    {
      "type": "text",
      "id": "whatsapp_phone",
      "label": "Número de WhatsApp",
      "default": "+573008602789",
      "info": "Número de WhatsApp con código de país (ejemplo: +573008602789)"
    },
    {
      "type": "text",
      "id": "whatsapp_button_text",
      "label": "Texto botón WhatsApp",
      "default": "WhatsApp"
    }
  ],
  "presets": [
    {
      "name": "Barra CTA Sticky Mobile"
    }
  ]
}
{% endschema %}
