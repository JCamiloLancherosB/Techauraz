/**
 * =============================================================================
 * PDP SCROLL-TRIGGER & VISIBILITY FIXES - January 2025 (Updated)
 * =============================================================================
 * 
 * PURPOSE: Fix critical visibility issues on Product Detail Pages (PDP)
 * 
 * PROBLEMS SOLVED:
 * 1. Content hidden with opacity:.01 when scroll-trigger animations fail
 * 2. Product description invisible when JS doesn't execute
 * 3. Info elements stuck offscreen with transform
 * 4. Content invisible when IntersectionObserver not supported
 * 5. Scrollbars on product titles
 * 6. Grid alignment issues on PDP
 * 
 * STRATEGY:
 * - Make content visible by default
 * - Only hide when explicitly offscreen
 * - Provide noscript fallbacks
 * - Respect prefers-reduced-motion
 * 
 * NOTE ON CSS APPROACH (UPDATED JAN 2025):
 * All !important flags have been removed from this file. Visibility is now
 * ensured through:
 * - Proper CSS cascade order (this file loads after base.css)
 * - Z-index hierarchy (forms: 5, buttons: 10, modals: 100+)
 * - Explicit visibility declarations that override scroll-trigger animations
 * - Specificity through targeted selectors rather than forced overrides
 * 
 * This provides more maintainable and predictable styling compared to the
 * previous approach of using !important flags.
 * 
 * =============================================================================
 */

/* =============================================================================
   1. SCROLL-TRIGGER VISIBILITY FIXES - CRITICAL
   ============================================================================= */

/**
 * OVERRIDE: Make scroll-trigger content visible by default
 * The base theme sets opacity:.01 which hides content if JS fails
 * We reverse this: content visible by default, only hidden when offscreen
 */

/* Default state: VISIBLE (override base.css opacity:.01) */
.scroll-trigger.animate--fade-in,
.scroll-trigger.animate--slide-in {
  opacity: 1 !important;
  visibility: visible !important;
}

/* Only hide when explicitly marked as offscreen */
.scroll-trigger--offscreen.animate--fade-in,
.scroll-trigger--offscreen.animate--slide-in {
  opacity: .01;
  visibility: hidden;
}

/* Remove transform offset by default - only apply when offscreen */
.scroll-trigger.animate--slide-in {
  transform: translateY(0) !important;
}

.scroll-trigger--offscreen.animate--slide-in {
  transform: translateY(2rem);
}

/* =============================================================================
   4. NOSCRIPT FALLBACK - WHEN JS IS DISABLED
   ============================================================================= */

/**
 * Ensure all content is visible when JavaScript is disabled
 * This is critical for accessibility and SEO
 */

noscript .scroll-trigger,
.no-js .scroll-trigger,
.no-js .scroll-trigger.animate--fade-in,
.no-js .scroll-trigger.animate--slide-in {
  opacity: 1 !important;
  visibility: visible !important;
  transform: none !important;
  animation: none !important;
}

/* =============================================================================
   5. PREFERS-REDUCED-MOTION SUPPORT
   ============================================================================= */

/**
 * Respect user preference for reduced motion
 * Make all content immediately visible without animations
 */

@media (prefers-reduced-motion: reduce) {
  .scroll-trigger,
  .scroll-trigger.animate--fade-in,
  .scroll-trigger.animate--slide-in,
  .scroll-trigger--offscreen {
    opacity: 1 !important;
    visibility: visible !important;
    transform: none !important;
    animation: none !important;
    transition: none !important;
  }
}

.product__info-wrapper {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  position: relative !important;
  transform: none !important;
}

/* =============================================================================
   7. TITLE SCROLLBAR FIXES
   ============================================================================= */

/**
 * Remove scrollbars from titles
 * Ensure text wraps properly instead of overflowing
 */

.product__title,
.product__title h1,
.h1.product__title,
h1.product__title {
  overflow: visible !important;
  overflow-x: visible !important;
  overflow-y: visible !important;
  white-space: normal !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  hyphens: auto !important;
  max-width: 100% !important;
  height: auto !important;
  max-height: none !important;
  line-height: 1.2 !important;
}

/* Responsive font sizing for titles - using rem for better accessibility */
/* Desktop-first approach with max-width queries (Shopify Dawn theme standard):
   - This approach ensures desktop gets optimal size first, then scales down
   - Matches Dawn theme patterns for consistency with base theme
   - Default: 2.5rem (desktop 990px and above)
   - max-width: 989px: 2rem (tablet and smaller)
   - max-width: 749px: 1.75rem (mobile)
   - max-width: 479px: 1.5rem (small mobile)
*/
.product__title h1 {
  font-size: 2.5rem;
}

@media screen and (max-width: 989px) {
  .product__title h1 {
    font-size: 2rem;
  }
}

@media screen and (max-width: 749px) {
  .product__title h1 {
    font-size: 1.75rem;
  }
}

@media screen and (max-width: 479px) {
  .product__title h1 {
    font-size: 1.5rem;
  }
}

/* =============================================================================
   8. URGENCY BADGES - ALWAYS VISIBLE
   ============================================================================= */

/**
 * Conversion elements like urgency badges must always display
 */

.product-urgency-badge,
.urgency-indicator {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  overflow: visible !important;
  white-space: normal !important;
}

.product-countdown,
.product-trust-payments,
.product-delivery-steps,
.trust-indicators {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* =============================================================================
   11. COLLAPSIBLE TABS & ACCORDIONS - VISIBLE
   ============================================================================= */

/**
 * Product information in accordions should be discoverable
 */

.product__accordion,
.accordion,
details.product__accordion {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* =============================================================================
   12. COMPLEMENTARY/RELATED PRODUCTS - VISIBLE
   ============================================================================= */

/**
 * Related products section must render
 */

.complementary-products,
product-recommendations,
.related-products {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* =============================================================================
   13. FALLBACK FOR BROWSERS WITHOUT INTERSECTION OBSERVER
   ============================================================================= */

/**
 * For older browsers without IntersectionObserver support
 * The JavaScript in animations.js handles the primary fallback by detecting
 * browser support and ensuring all elements are visible if IO is not available.
 * 
 * This CSS section provides additional defense-in-depth through the default
 * visible state defined in section 1, which applies to all browsers.
 * 
 * No additional CSS rules needed here since:
 * 1. Default state is visible (section 1)
 * 2. JavaScript fallback handles unsupported browsers
 * 3. Noscript tags in theme.liquid ensure CSS loads even with JS disabled
 */

/* =============================================================================
   14. MOBILE SPECIFIC FIXES
   ============================================================================= */

@media screen and (max-width: 749px) {
  /* All critical elements visible on mobile */
  .product__description,
  .product__title,
  .product__price,
  .product-form,
  .product-form__submit {
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
  }
  
  /* No transforms on mobile that could hide content */
  .scroll-trigger,
  .product__info-wrapper {
    transform: none !important;
  }
}

.product__media-wrapper {
  z-index: 1;
}

.product__info-wrapper {
  z-index: 2;
}

.product-form,
.product-form__buttons {
  z-index: 3;
  position: relative;
}

/* =============================================================================
   END OF FILE
   ============================================================================= */
